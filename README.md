# RentalMS
- 프로젝트 생성
  - https://start.spring.io/
- 패키지 구조 생성
  - 핵사노널 or 레이어드
- 도메인 모델 개발
  - 엔티티,VO 생성
  - 도메인 모델 테스트
- 응용 서비스 개발
- 외부 영역 개발
  - 인바운드 영역
    - REST API
    - DTO
  - 아웃바운드 영역
    - 레파지토리
    - OR 매핑
- 도커 파일 생성
  - Dockerfile 생성
  - 이미 존재함
    ```
    # 기반이 될 도커 이미지 선택 (여기서는 OpenJDK 11 사용)
    FROM openjdk:15-jdk-alpine
  
    # 빌드된 스프링 부트 JAR 파일을 복사
    COPY target/*SNAPSHOT.jar app.jar
  
    # 컨테이너가 실행될 포트 지정
    EXPOSE 8080
    ENV TZ=Asia/Seoul
    RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    ENTRYPOINT ["java","-Xmx400M","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar","--spring.profiles.active=docker"]
    ```

- 빌드
  - 어플리케이션 빌드
  
    ```
    mvn clean package 
    ```

- 컨테이너 생성
  - 도커 컨테이너 이미지 생성
  
    ```
     docker build -t rental-ms:0.0.1 . 
    ```

    ```
    docker image 
    ```

  - 도커 컨테이너 실행

    ``` 
    docker run --name rentalMS -p 8080:8080 rental-ms:0.0.1
    ```

- 카프카 컨테이너 생성
- 토픽 생성
 

- 도메인 모델 클래스도  
<img width="838" alt="image" src="https://github.com/cnaps/RentalMS/assets/15258916/ab18e473-3691-4624-8b27-b3fc8cc79569">

- RentalItem을 VO 로 선언했으나 rented등의 값이 변경됨으로 불변성을 잃음 , 엔티티로 다시 개념 정의 하던지? 아니면 overdueItem으로 분리할 필요성 있음.


- 전체 구현 아키텍처구성도
![image](https://github.com/cnaps/RentalMS/assets/15258916/46713f64-951f-45b6-a04c-9c6ffbeb3d6c)

대여서비스 구현 
- 빈 기본 프로젝트 깃 클론    ----1
  - 기본 프로젝트 pom 의존도 환경 설명
- 패키지 구조 정의 
  - 헥사고널, 레이어드 에 따라 다름 
- 내부영역 : 도메인 모덷 구현 
  - 클래스 생성, 엔티티, VO, Enum
    - 클래스 속성 정의
  - 비지니스 로직 구현
  - 도메인 모델 테스트    ----2
- 내부영역 : 응용 서비스 구현 
  - 인터페이스 정의 (유스케이스)
  - 서비스 구현체(포트) 구현
  - 동시에 아우터 포트도 구현해야함 (헥사고널의 경우)
- 외부영역 구현
  - API 어댑터 구현
  - JPA 어댑터 구현 
- API 테스트 수행 
  - API Test 도구 설치 또는 스웨거로 테스트
  - H2 DB 및 테이터 생성 확인    ----3
-------------------------------

상품서비스 구현    -----4

회원 서비스 구현   -----5

CQRS 구현 
베스트 상품 서비스 구현 
- 빈 기본 프로젝트 깃 클론 
- 패키지 구조 정의
  - 레이어드 구조
- 도메인 모델 구현
  - 클래스 생성, 엔티티, VO, Enum
  - 클래스 속성 정의
  - 비지니스 로직 구현
  - 도메인 모델 테스트 
- 비지니스 로직 레이어 구현 
  - 서비스 인터페이스 구현 
  - 서비스 구현체 구현
- 데이터 엑세스 레이어 구현
  - JPA 레파지토리 구현
  - 몽고 DB 
- 프리젠테이션 레이어 구현
  - API 컨트롤러 구현
- API 테스트 수행
  - API Test 도구 설치 또는 스웨거로 테스트
  - 몽고 DB UI 도구 설치, 몽고 DB 및 테이터 생성 확인    -----6
----------------------------------------

EDA 구현
- 카프카 설치
  - 도커 컴포저로 카프카 로딩 
  - 카프카 UI 설치
- 도메인 이벤트 구현
  - 아이템 대여됨 이벤트
  - 아이템 반납됨 이벤트
- 대여 --> 상품 구현         -----7
  - 대여 프로듀서 어댑터 구현
  - 상품 컨슈머 어댑터 구현
- 대여 --> 회원 구현        ------8
  - 회원 컨슈머 어댑터 구현
- 대여 --> 베스트 상품 구현   ------9
  - 베스트 상품 어댑터 구현
- 상품 --> 베스트 상품 구현   ------10
  - 상품 프로듀서 어댑터 구현
  - 베스트 상품 어댑터 구현 
통합테스트 수행
  - 시나리오 
    - 도서 등록
    - 도서 카드 생성
    - 도서 대여
      - 상품 상태 확인(대여불가)
      - 회원 포인트 확인(+)
      - 베스트 상품 추가 확인
    - 도서 반납 
      - 상품 상태 확인(대여가능)
      - 회원 포인트 확인 (+)
    - 도서 연체
      - 도서 카드 상태 확인
        - 
    - API테스트 수행

배포
- 도커 파일 생성 
- 컨테이너 생성
- 컨테이너 배포 